<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Databases and Developers</title>

		<meta name="description" content="Talk on databases and being a developer given at Metis - Chicago, by Kyle Tolle.">
		<meta name="author" content="Kyle Tolle">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

<style>
.reveal code {
  border: 1px solid #444;
  border-radius: 5px;
  background-color: #444;
  padding: 0px 4px;
}
</style>

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

        <section>
<h1 id="databases-and-developers">Databases and Developers</h1>

<p><code>SELECT * FROM exciting_knowledge;</code></p>

<aside class="notes">

</aside>
</section>
<section>

<p>First off</p>

<h2 id="ask-questions">Ask questions</h2>

<h3 id="at-any-time">at any time!</h3>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="who-am-i">Who am I?</h2>

<h1 id="kyle-tolle">Kyle Tolle</h1>

<p><a href="http://kyletolle.com">kyletolle.com</a> |
<a href="https://twitter.com/kyletolle">@kyletolle</a></p>

<p>Software Engineer on Sabbatical</p>

<aside class="notes">

Member of the software industry for 8 years.

</aside>
</section>
<section>

<h3 id="not-a-database-expert">Not a database expert</h3>

<p>but I want to</p>

<h2 id="share">share</h2>

<p>some of what</p>

<h2 id="ive-learned">I’ve learned</h2>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="slides-for-this-talk">Slides for this talk</h2>

<h3 id="presentation">Presentation:</h3>

<p><a href="https://kyletolle.github.io/dbs_and_devs_talk">https://kyletolle.github.io/dbs_and_devs_talk</a></p>

<h3 id="code">Code:</h3>

<p><a href="https://github.com/kyletolle/dbs_and_devs_talk">https://github.com/kyletolle/dbs_and_devs_talk</a></p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="past-jobs">Past Jobs</h1>

<ul>
  <li>tools supporting satellite simulation</li>
  <li>ICBM command and control system</li>
  <li>geospatial data collection</li>
  <li>mobile wallet applications</li>
</ul>

<aside class="notes">

mobile wallet includes things like order-ahead, loyalty, coupons for large restaurant chains.
These jobs are diverse but they all had something in common: using databases.

</aside>
</section>
<section>

<h1 id="overview">Overview</h1>

<ul>
  <li>Background</li>
  <li>ORMs</li>
  <li>DB Theory</li>
  <li>Important Concepts</li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<p>Let’s start at</p>

<h2 id="the-very-beginning">The Very Beginning</h2>

<aside class="notes">

Sometimes we hop into the middle of things, and it's good to think back on the beginning and understand the context in which things came about.
You're going to be familiar with this first part, so I will breeze through it.

</aside>
</section>
<section>

<h3 id="humans-are">Humans are</h3>

<h2 id="knowledge-hunters">knowledge-hunters</h2>

<p>&amp;</p>

<h2 id="data-gatherers">data-gatherers</h2>

<aside class="notes">

We take in the world as it is and can see it how it will be later.
We see a line on the ground and know a deer walks here often.
Then we wait there, because we know we will see the deer in the future.

</aside>
</section>
<section>

<h2 id="we-like-to">We like to</h2>

<ul>
  <li>Collect data</li>
  <li>Store it</li>
  <li>Process it</li>
</ul>

<aside class="notes">

We gather information from the world around us and do a lot with it.

</aside>
</section>
<section>

<h2 id="software-crunches">Software crunches</h2>

<h1 id="data">data</h1>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="data-needs">Data needs</h2>

<h1 id="a-home">a home</h1>

<aside class="notes">

In order to do something useful with software, we need data.
We need to store that data somewhere.
That somewhere is usually databases.

</aside>
</section>
<section>

<h2 id="aka">a.k.a.</h2>

<h1 id="a-data-store">A Data Store</h1>

<aside class="notes">

</aside>
</section>
<section>

<h3 id="datas-earliest-home">Data’s earliest home</h3>

<h1 id="the-flat-file">The Flat File</h1>

<aside class="notes">

</aside>
</section>
<section>

<p><code>cat students.csv</code></p>

<pre class="text"><code>Id, Name, Grade
1,  Ted,  B
2,  Stan, A-
3,  Fred, C++
4,  Ned,  5%
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="easy-peasy">Easy peasy</h2>

<p>Some things don’t need to be complicated</p>

<aside class="notes">

</aside>
</section>
<section>

<h3 id="flat-files">Flat Files</h3>

<p>can be used for</p>

<h2 id="data-interchange">Data Interchange</h2>

<aside class="notes">

Passing data between systems

</aside>
</section>
<section>

<h2 id="common-flat-file-types">Common flat file types</h2>

<ul>
  <li>CSV</li>
  <li>HTML</li>
  <li>XML</li>
  <li>JSON</li>
  <li>ini</li>
  <li>conf</li>
</ul>

<aside class="notes">

Flat files allow us to pass data between systems.
They allow us to store simple information when anything more complex would be overkill.

</aside>
</section>
<section>

<p>Then, things grow</p>

<h2 id="complicated">Complicated</h2>

<aside class="notes">

</aside>
</section>
<section>

<h3 id="want-to">Want to</h3>

<ul>
  <li>know more</li>
  <li>ask questions</li>
  <li>give access</li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="use-the-data-for">Use the data for</h2>

<ul>
  <li>Web application</li>
  <li>Report generation</li>
  <li>Analysis performation</li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<p>Fortunately for us,</p>

<p>some smart folks</p>

<h2 id="invented-the">invented the</h2>

<h1 id="database">database</h1>

<aside class="notes">

</aside>
</section>
<section>

<p>Popular DBs according to Devs</p>

<p><img src="./popular_dbs.png" alt="Popular DBs chart" /></p>

<p><small><a href="https://insights.stackoverflow.com/survey/2017#technology-databases">https://insights.stackoverflow.com/survey/2017#technology-databases</a></small></p>

<aside class="notes">

</aside>
</section>
<section>

<p>Many common DBs use the</p>

<h2 id="relational-model">Relational Model</h2>

<p><img src="./relational_model_concepts.png" alt="Relational Model Concepts" />*</p>

<p><small>*: By <a href="//commons.wikimedia.org/wiki/User:AutumnSnow" title="User:AutumnSnow">User:AutumnSnow</a> - <span class="int-own-work" lang="en">Own work</span>, <a href="http://creativecommons.org/licenses/by-sa/3.0/" title="Creative Commons Attribution-Share Alike 3.0">CC BY-SA 3.0</a>, <a href="https://commons.wikimedia.org/w/index.php?curid=1313684">Link</a><small></small></small></p>

<aside class="notes">

</aside>
</section>
<section>

<p>In other words, we have a</p>

<h1 id="table">Table</h1>

<p>with</p>

<h2 id="rows--columns">Rows &amp; Columns</h2>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="sql-is-a-abbr-titledomain-specific-languagedslabbr">SQL is a <abbr title="domain-specific language">DSL</abbr></h1>

<p>for managing data in a</p>

<h2 id="relational-db">Relational DB</h2>

<aside class="notes">

</aside>
</section>
<section>

<p>Remember our student data?</p>

<aside class="notes">

</aside>
</section>
<section>

<pre class="text"><code>Id, Name, Grade
1,  Ted,  B
2,  Stan, A-
3,  Fred, C++
4,  Ned,  5%
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="put-a-database-on-it">Put a database on it!</h2>

<p><img src="./put_a_bird_on_it.jpg" alt="Put a bird on it" /></p>

<aside class="notes">

Portlandia!

</aside>
</section>
<section>

<p><code>students</code></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>name</th>
      <th>grade</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Ted</td>
      <td>B</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Stan</td>
      <td>A-</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Fred</td>
      <td>C++</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Ned</td>
      <td>5%</td>
    </tr>
  </tbody>
</table>

<aside class="notes">

</aside>
</section>
<section>

<p>The <code>table</code> has a <code>schema</code>.</p>

<p>Each <code>row</code> is a <code>record</code>.</p>

<p>Each <code>column</code> is an <code>attribute</code>.</p>

<aside class="notes">

</aside>
</section>
<section>

<p>Let’s drop into</p>

<h1 id="postgres">Postgres</h1>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="set-up-postgres">Set up Postgres</h1>

<pre class="sh"><code>brew install postgres
brew services start postgresql
createdb dbs_and_devs_talk
psql dbs_and_devs_talk
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="create-a-table">Create a Table</h1>

<pre><code>CREATE TABLE students(
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  grade TEXT NOT NULL
);
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="insert-data">Insert Data</h1>

<pre><code>INSERT INTO students (name, grade) values ('Ted', 'B');
INSERT INTO students (name, grade) values ('Stan', 'A-');
INSERT INTO students (name, grade) values ('Fred', 'C++');
INSERT INTO students (name, grade) values ('Ned', '5%');
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="view-data">View Data</h2>

<pre><code>SELECT * FROM students;
</code></pre>

<pre class="text"><code> id | name | grade
====+======+=======
  1 | Ted  | B
  2 | Stan | A-
  3 | Fred | C++
  4 | Ned  | 5%
(4 rows)
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="create-a-relationship">Create a Relationship</h2>

<pre><code>CREATE TABLE backpacks(
  id SERIAL PRIMARY KEY,
  color TEXT NOT NULL,
  student_id INT references students(id)
);
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="insert-data">Insert Data</h1>

<pre><code>INSERT INTO backpacks (color, student_id) values('blue', 1);
INSERT INTO backpacks (color, student_id) values('red', 2);
INSERT INTO backpacks (color, student_id) values('grey', 3);
INSERT INTO backpacks (color, student_id) values('green', 4);
INSERT INTO backpacks (color, student_id) values('clear', 1);
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="view-data">View Data</h2>

<pre><code>SELECT * FROM backpacks;
</code></pre>

<pre class="text"><code> id | color | student_id
====+=======+============
  1 | blue  |          1
  2 | red   |          2
  3 | grey  |          3
  4 | green |          4
  5 | clear |          1
(5 rows)
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="backback-colors-for-a-student">Backback colors for a Student</h2>

<pre><code>SELECT color FROM backpacks WHERE student_id = 1;
</code></pre>

<pre class="text"><code> color
=======
 blue
 clear
(2 rows)
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="backpacks-for-all-students">Backpacks for all students</h2>

<pre><code>SELECT s.name, b.color FROM students as s
  JOIN backpacks as b ON s.id = b.student_id
  ORDER BY s.name;
</code></pre>

<pre class="text"><code> name | color
======+=======
 Fred | grey
 Ned  | green
 Stan | red
 Ted  | blue
 Ted  | clear
(5 rows)
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="quit-postgres">Quit Postgres</h2>

<p><code>\q</code></p>

<aside class="notes">

</aside>
</section>
<section>

<p>Do stuff</p>

<h2 id="the-hard-way">the hard way</h2>

<p>for a while</p>

<aside class="notes">

</aside>
</section>
<section>

<p><img src="no_tools.jpg" alt="I dare you not to use your tools" /></p>

<aside class="notes">

</aside>
</section>
<section>

<h3 id="allows-you-to-understand">Allows you to understand</h3>

<ul>
  <li>the benefits of your tools</li>
  <li>the limits of your tools</li>
  <li>how to work around those limits</li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<p>Plus, learn to</p>

<h2 id="channel-your-anger">channel your anger</h2>

<p><img src="./angry_anakin.jpg" alt="Angry Anakin" /></p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="useful-tools">Useful Tools</h1>

<ul>
  <li><a href="https://www.pgadmin.org/download/pgadmin-4-macos/">pgAdmin 4</a></li>
  <li><a href="https://eggerapps.at/postico/">Postico</a></li>
  <li>ORMs</li>
</ul>

<aside class="notes">

Great for managing the database without typing everything yourself.

</aside>
</section>
<section>

<h1 id="orm">ORM</h1>

<p>Object-Relational Mapping</p>

<aside class="notes">

</aside>
</section>
<section>

<p>Maps</p>

<h2 id="database-records">database records</h2>

<p>to</p>

<h2 id="object-instances">object instances</h2>

<aside class="notes">

Inflates the DB data into an instantiated class

</aside>
</section>
<section>

<h1 id="ruby-on-rails">Ruby on Rails</h1>

<p>follows the</p>

<h2 id="active-record-patternhttpswwwmartinfowlercomeaacatalogactiverecordhtml"><a href="https://www.martinfowler.com/eaaCatalog/activeRecord.html">Active Record pattern</a></h2>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="install-ruby">Install Ruby</h1>

<pre class="sh"><code>brew install rbenv
rbenv install 2.4.2
rbenv global 2.4.2
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="ensure-sqlite3httpswwwsqliteorg-is-installed">Ensure <a href="https://www.sqlite.org/">SQLite3</a> is installed</h2>

<p><code>sqlite3 --version</code></p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="install-rails">Install Rails</h1>

<pre class="sh"><code>gem install rails
rails --version
</code></pre>

<p><br /></p>

<p><small>We expect to see <code>Rails 5.1.4</code></small></p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="create-rails-app">Create Rails app</h1>

<pre class="sh"><code>rails new blog
cd blog
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="create-posts">Create Posts</h1>

<pre class="sh"><code>rails generate scaffold Post title:string body:text
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<pre><code>class CreatePosts &lt; ActiveRecord::Migration[5.1]
  def change
    create_table :posts do |t|
      t.string :title
      t.text :body

      t.timestamps
    end
  end
end
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="run-db-migration">Run db migration</h1>

<pre class="sh"><code>rails db:migrate
</code></pre>


<aside class="notes">

</aside>
</section>
<section>

<h2 id="enter-ruby-console">Enter Ruby console</h2>

<pre class="sh"><code>rails console
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="activerecord-is-a-dsl">ActiveRecord is a DSL</h2>

<p>We can modify SQL data with it</p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="create-a-new-post">Create a new post</h1>

<pre class="ruby"><code>Post.create title: 'First!', body: 'Viral to the max.'
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<p>The console shows us</p>

<h2 id="sql-queries">SQL queries</h2>

<p>for various</p>

<h2 id="activerecord-methods">ActiveRecord methods</h2>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="output-for-create">Output for create</h2>

<pre class="text"><code>(0.1ms)  begin transaction
SQL (0.4ms)  INSERT INTO "posts"
  ("title", "body", "created_at", "updated_at")
  VALUES (?, ?, ?, ?)
  [
    ["title", "First!"],
    ["body", "Viral to the max."],
    ["created_at", "2017-11-29 01:37:50.231847"],
    ["updated_at", "2017-11-29 01:37:50.231847"]
  ]
(0.7ms)  commit transaction
=&gt; #&lt;Post id: 1, title: "First!",
     body: "Viral to the max.",
     created_at: "2017-11-29 01:37:50",
     updated_at: "2017-11-29 01:37:50"&gt;
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="lets-break-it-down">Let’s break it down</h2>

<ul>
  <li>Transactions</li>
  <li>Queries</li>
  <li>Duration</li>
  <li>Conventions</li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="transactionshttpsenwikipediaorgwikidatabasetransaction"><a href="https://en.wikipedia.org/wiki/Database_transaction">Transactions</a></h1>

<pre class="text"><code>(0.1ms)  begin transaction
...
(0.7ms)  commit transaction
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<p>Multiple queries either</p>

<h2 id="all-happen">all happen</h2>

<p>or</p>

<h2 id="none-happen">none happen</h2>

<aside class="notes">

</aside>
</section>
<section>

<p>An error in a query causes a</p>

<h2 id="rollback">Rollback</h2>

<aside class="notes">

</aside>
</section>
<section>

<p>Provides protection from</p>

<h2 id="errors">Errors</h2>

<p>causing</p>

<h2 id="inconsistent-data">Inconsistent Data</h2>

<aside class="notes">

</aside>
</section>
<section>

<p>Important when</p>

<h2 id="modifying-many-records">modifying many records</h2>

<p>in</p>

<h2 id="one-logical-change">one logical change</h2>

<aside class="notes">

Like transferring money from one bank account to another.
One must be credited and the other must be debited at the same time.
Either both get updated or neither do.

</aside>
</section>
<section>

<h1 id="queries">Queries</h1>

<pre class="text"><code>SQL (0.4ms)  INSERT INTO "posts"
  ("title", "body", "created_at", "updated_at")
  VALUES (?, ?, ?, ?)
  [
    ["title", "First!"],
    ["body", "Viral to the max."],
    ["created_at", "2017-11-29 01:37:50.231847"],
    ["updated_at", "2017-11-29 01:37:50.231847"]
  ]
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="dynamically-generated">Dynamically generated</h2>

<p>ActiveRecord analyzes the table and</p>

<p>generates the correct query</p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="duration">Duration</h1>

<pre class="text"><code>SQL (0.4ms)  INSERT INTO "posts" ...
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<p>ActiveRecord measures</p>

<h2 id="how-long">how long</h2>

<p>each query takes to run</p>

<aside class="notes">

</aside>
</section>
<section>

<p>Can help</p>

<h2 id="profile-queries">profile queries</h2>

<p>and find slow ones</p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="conventions">Conventions</h1>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="naming">Naming</h2>

<p>Table name (<code>posts</code>) is pluralized</p>

<p>Class name (<code>Post</code>) is singular</p>

<aside class="notes">

</aside>
</section>
<section>

<p>Handles</p>

<h2 id="complex-cases">complex cases</h2>

<p>like</p>

<h3 id="people--person"><code>people</code> &amp; <code>Person</code></h3>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="timestamps">Timestamps</h2>

<aside class="notes">

</aside>
</section>
<section>

<p>Notice the</p>

<h3 id="updatedat--createdat"><code>updated_at</code> &amp; <code>created_at</code></h3>

<p>columns?</p>

<aside class="notes">

</aside>
</section>
<section>

<p>ActiveRecord automatically tracks</p>

<h2 id="creation--modification">creation &amp; modification</h2>

<p>times of each record</p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="other-examples">Other Examples</h1>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="viewing">Viewing</h1>

<p><code>post = Post.last</code></p>

<pre class="text"><code>SELECT  "posts".* FROM "posts"
  ORDER BY "posts"."id" DESC LIMIT ?  [["LIMIT", 1]]
=&gt; #&lt;Post id: 1,
          title: "First!",
          body: "Viral to the max.",
          created_at: "2017-11-29 01:37:50",
          updated_at: "2017-11-29 01:37:50"&gt;
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="using">Using</h1>
<p><code>post.title</code></p>

<pre class="text"><code>=&gt; "First!"
</code></pre>

<p><code>post.updated_at</code></p>

<pre class="text"><code>=&gt; Wed, 29 Nov 2017 02:31:07 UTC +00:00
</code></pre>


<aside class="notes">

</aside>
</section>
<section>

<h1 id="counting">Counting</h1>

<p><code>Post.count</code></p>

<pre class="text"><code>SELECT COUNT(*) FROM "posts"
=&gt; 1
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="destroying">Destroying</h1>

<p><code>Post.destroy_all</code></p>

<pre class="text"><code>SELECT "posts".* FROM "posts"
DELETE FROM "posts" WHERE "posts"."id" = ?  [["id", 1]]
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="just-a-sample">Just a sample</h2>

<p>This is not an exhaustive list</p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="exit-rails-console">Exit Rails Console</h1>

<p><code>exit</code></p>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="add-a-column-to-post">Add a Column to Post</h2>

<pre class="sh"><code>rails g migration AddCurrentSongToPosts current_song:string
</code></pre>

<pre class="ruby"><code>class AddCurrentSongToPosts &lt; ActiveRecord::Migration[5.1]
  def change
    add_column :posts, :current_song, :string
  end
end
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<p>Migrations support</p>

<h2 id="rolling-back-schema">rolling back schema</h2>

<p><code>rails db:rollback</code></p>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="create-a-relationship">Create a Relationship</h2>

<pre class="sh"><code>rails g model like post:references
</code></pre>

<pre class="ruby"><code>class CreateLikes &lt; ActiveRecord::Migration[5.1]
  def change
    create_table :likes do |t|
      t.references :post, foreign_key: true

      t.timestamps
    end
  end
end
</code></pre>

<ul>
  <li>Adds indexes for <code>post_id</code></li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="complex-relationship">Complex Relationship</h2>

<p>An author can publish many posts, and</p>

<p>a post can have many authors</p>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="complex-relationship-cont">Complex Relationship, cont.</h2>

<pre class="sh"><code>rails g model author name:string email:string
</code></pre>

<pre class="ruby"><code>class CreateAuthors &lt; ActiveRecord::Migration[5.1]
  def change
    create_table :authors do |t|
      t.string :name
      t.string :email

      t.timestamps
    end
  end
end
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="complex-relationship-cont">Complex Relationship, cont.</h2>

<pre class="sh"><code>rails g migration CreateJoinTableAuthorsPosts author post
</code></pre>

<pre class="ruby"><code>class CreateJoinTableAuthorsPosts &lt; ActiveRecord::Migration[5.1]
  def change
    create_join_table :authors, :posts do |t|
      # t.index [:author_id, :post_id]
      # t.index [:post_id, :author_id]
    end
  end
end
</code></pre>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="even-complexerer">Even Complexerer</h2>

<p>Sometimes the join tables are more complex</p>

<aside class="notes">

</aside>
</section>
<section>

<ul>
  <li>Give the concept a name, like <code>Publications</code></li>
  <li>Treat it like a model itself</li>
  <li>Consider needing additional data, like a
    <ul>
      <li><code>primary_author</code> boolean attribute</li>
      <li><code>royalty_earned</code> money attribute</li>
    </ul>
  </li>
  <li>Use Timestamps to know when changes happen</li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<p>Quick detour into</p>

<h2 id="database-theory">Database Theory</h2>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="acidhttpsenwikipediaorgwikiacid"><a href="https://en.wikipedia.org/wiki/ACID">ACID</a></h1>

<p>A single DB can provide</p>

<ul>
  <li>Atomicity</li>
  <li>Consistency</li>
  <li>Isolation</li>
  <li>Durability</li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="cap-theoremhttpsenwikipediaorgwikicaptheorem"><a href="https://en.wikipedia.org/wiki/CAP_theorem">CAP Theorem</a></h1>

<p>In the event of a network failure,</p>

<p>a distributed DB must choose between</p>

<ul>
  <li>consistency</li>
  <li>availability</li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="basehttpsenwikipediaorgwikieventualconsistency"><a href="https://en.wikipedia.org/wiki/Eventual_consistency">BASE</a></h1>

<p>Some distributed DBs prioritize availability.</p>

<p>Eventually, all the data will be consistent.</p>

<ul>
  <li>Basically Available</li>
  <li>Soft state</li>
  <li>Eventual consistency</li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="other-topics">Other Topics</h1>

<aside class="notes">

</aside>
</section>
<section>

<h3 id="orms">ORMs</h3>

<p>support multiple databases through</p>

<h3 id="db-adapters">DB Adapters</h3>

<aside class="notes">

The same DSL works for MySQL, Postgres, etc.
You don't have to change your Rails code even if you switch your backing data store.

</aside>
</section>
<section>

<h3 id="orms">ORMS</h3>

<p>generate queries on the fly, so</p>

<p>are slower than hard-coded queries</p>

<aside class="notes">

Dynamically generating the query is slower than having one hardcoded, but it's a tradeoff. Hardcoding a query can make your application more fragile to changes in the future, whereas the dynamic queries will update themselves as things change and the ORM picks up those changes. A hardcoded query might refer to a column that was renamed, for instance.

</aside>
</section>
<section>

<h3 id="orms">ORMs</h3>

<p>inflate objects with</p>

<p>data from the DB, which</p>

<h3 id="isnt-ideal-for-bulk-work">isn’t ideal for bulk work</h3>

<aside class="notes">

Can be slow when you want to quickly loop over a single attribute of all records.
Especially when the object is complex and has special serialization rules.

</aside>
</section>
<section>

<h2 id="alternate-sql-library">Alternate SQL Library</h2>

<p>like <a href="https://github.com/jeremyevans/sequel">sequel</a> for Ruby</p>

<h3 id="might-be-more-performant">might be more performant</h3>

<aside class="notes">

It does not inflate data the same way.
Working closer to the metal.

</aside>
</section>
<section>

<h2 id="n1-query-explosions">N+1 Query Explosions</h2>

<p>ORMS may lazily fetch data, resulting in</p>

<p>1,000+1 queries for</p>

<p>1,000 posts by 1 author</p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="primary-keyhttpsenwikipediaorgwikirelationaldatabaseprimarykey"><a href="https://en.wikipedia.org/wiki/Relational_database#Primary_key">Primary Key</a></h1>

<p>Key (like <code>id</code>) that <a href="https://en.wikipedia.org/wiki/Unique_key">uniquely</a> identifies this record</p>

<p>No two records have the same primary key</p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="foreign-keyhttpsenwikipediaorgwikiforeignkey"><a href="https://en.wikipedia.org/wiki/Foreign_key">Foreign Key</a></h1>

<p>Key (like <code>post_id</code>) that uniquely identifies</p>

<p>some other row in a different table or in this table</p>

<aside class="notes">

</aside>
</section>
<section>

<h3 id="why-reference-a-row-in-the-same-table">Why reference a row in the same table?</h3>

<p>To allow parent-child relationships</p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="indexes">Indexes</h1>

<p>Can speed up lookups, but</p>

<p>require extra space on disk and</p>

<p>slow down writes</p>

<aside class="notes">

Can make looking up a user by their email fast.
Every change to a users email means updating the index.

</aside>
</section>
<section>

<h1 id="sanitization">Sanitization</h1>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="never-trust-user-input">Never trust user input</h2>

<p><a href="https://en.wikipedia.org/wiki/SQL_injection">SQL injection</a> can cause your DB to be hacked</p>

<p>Some ORMs may sanitize some data by default</p>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="responsibility-falls-on-you">Responsibility falls on you</h2>

<h3 id="to-ensure-data-is-sanitized">to ensure data is sanitized</h3>

<p>before entering your system</p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="permissions">Permissions</h1>

<p>Some users might only need read-only access</p>

<p>Review DB permissions to reduce risk of accidental</p>

<h3 id="deletion-or-modification">deletion or modification</h3>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="normalizationhttpsenwikipediaorgwikidatabasenormalization"><a href="https://en.wikipedia.org/wiki/Database_normalization">Normalization</a></h1>

<p>Removing duplication across tables</p>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="normal-forms">Normal Forms</h2>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/First_normal_form">1NF</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Second_normal_form">2NF</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Third_normal_form">3NF</a>
    <ul>
      <li>“Nothing but the key”</li>
    </ul>
  </li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="constraintshttpsenwikipediaorgwikidataintegritydatabases"><a href="https://en.wikipedia.org/wiki/Data_integrity#Databases">Constraints</a></h1>

<ul>
  <li>primary key</li>
  <li>foreign key</li>
  <li>not null</li>
  <li>unique</li>
</ul>

<aside class="notes">

Helps the DBMS enforce data integrity

</aside>
</section>
<section>

<h1 id="migrations">Migrations</h1>

<p>Changing the database schema as your needs change</p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="migrations-cont">Migrations, cont.</h1>

<ul>
  <li>Migrating the database by hand is tricky</li>
  <li>Need to be consistent</li>
  <li>Need to do it across many machines (many developers)</li>
  <li>Need to do it differently in different environments
    <ul>
      <li>PRD has multiple DBs whereas DEV has one local DB</li>
    </ul>
  </li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="migrations-cont">Migrations, cont.</h1>

<ul>
  <li>Take databases offline
    <ul>
      <li>Can make changes that would break your application</li>
    </ul>
  </li>
  <li>Keep databases online
    <ul>
      <li>Have to make sure old version of app works with new DB schema</li>
      <li>Might have to make multiple deployments</li>
    </ul>
  </li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="migrations-cont">Migrations, cont.</h1>

<p>To keep the db online and rename a column:</p>

<ul>
  <li>First deploy
    <ul>
      <li>Duplicate column <code>old_name</code> to one called <code>new_name</code></li>
      <li>Add code that updates <code>new_name</code> as well as <code>old_name</code></li>
    </ul>
  </li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="migrations-cont">Migrations, cont.</h1>
<ul>
  <li>Second deploy
    <ul>
      <li>Change all code references from <code>old_name</code> to <code>new_name</code></li>
      <li>Remove now-unused column <code>old_name</code></li>
    </ul>
  </li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="data-integrityhttpsenwikipediaorgwikidataintegritydatabases"><a href="https://en.wikipedia.org/wiki/Data_integrity#Databases">Data integrity</a></h1>

<p>Application-level integrity vs Database-level integrity</p>

<ul>
  <li>Database can enforce referential integrity
    <ul>
      <li>Post exists when creating a like</li>
    </ul>
  </li>
  <li>Application can enforce higher-level things
    <ul>
      <li>Only a person with specific permissions can modify this post</li>
    </ul>
  </li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="locks">Locks</h1>

<p>Adding a non-null column to a large table</p>

<p>can lock the table</p>

<p>and prevent reads or writes</p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="locks-cont">Locks, cont.</h1>

<p>To prevent a long table lock:</p>

<ul>
  <li>Add a column that allows null values
    <ul>
      <li>Table is only locked for a short time</li>
    </ul>
  </li>
  <li>Update each row to have a default value
    <ul>
      <li>This will lock each row for a short time</li>
    </ul>
  </li>
  <li>Update the column to not allow null values
    <ul>
      <li>Since each column already has a value, the lock is released quickly</li>
    </ul>
  </li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="scaling">Scaling</h2>

<ul>
  <li>Vertical
    <ul>
      <li>Faster CPUs</li>
      <li>More Memory</li>
      <li>More Disk Space</li>
      <li><a href="https://en.wikipedia.org/wiki/Database_caching">Caching</a></li>
      <li><a href="https://en.wikipedia.org/wiki/Partition_(database)">Partitioning</a> data across tables</li>
    </ul>
  </li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="scaling-cont">Scaling, cont.</h2>

<ul>
  <li>Horizontal
    <ul>
      <li>Load balancing</li>
      <li>Create a pool of nodes</li>
      <li>Add more nodes to the pool</li>
      <li><a href="https://en.wikipedia.org/wiki/Shard_(database_architecture)">Sharding</a> data across nodes</li>
    </ul>
  </li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="scaling-cont">Scaling, cont.</h2>

<ul>
  <li>Tools to manage bigness
    <ul>
      <li><a href="https://github.com/github/gh-ost">gh-ost</a> for migrations</li>
      <li><a href="http://hadoop.apache.org/">Hadoop</a></li>
    </ul>
  </li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="fault-tolerance">Fault tolerance</h2>

<p>If one node goes down,</p>

<p>another can still serve requests</p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="recovery">Recovery</h1>

<p>Make regular backups of databases</p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="recovery-cont">Recovery, cont.</h1>

<p>Have a restore process</p>

<h3 id="try-out-the-restore-process">Try out the restore process</h3>

<p>to make sure it works!</p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="nosql-dbs">NoSQL DBs</h1>

<ul>
  <li><a href="https://www.mongodb.com/">MongoDB</a> is a document-based store</li>
  <li><a href="https://redis.io/">Redis</a> is a key-value store</li>
  <li><a href="http://cassandra.apache.org/">Cassandra</a> is a column-based store</li>
  <li><a href="https://neo4j.com/">Neo4j</a> is a graph-based store</li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="other-topics-to-consider">Other topics to consider</h2>

<ul>
  <li>Data Types</li>
  <li>Views</li>
  <li>Triggers</li>
  <li>Full text search</li>
  <li>Security</li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="other-topics-to-consider-cont">Other topics to consider, cont.</h2>

<ul>
  <li>Stored Procedures</li>
  <li>Reports/Analytics</li>
  <li>Spatial extensions</li>
  <li>Self-hosted vs Cloud-hosted</li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="links">Links</h2>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/Flat_file_database">Flat files</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Relational_model">Relational model</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Relational_database">Relational database</a></li>
  <li><a href="https://en.wikipedia.org/wiki/SQL">SQL</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Table_(database)">Tables</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Field_(computer_science)">Fields</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Active_record_pattern">Active Record pattern</a></li>
  <li><a href="https://en.wikipedia.org/wiki/View_(SQL)">Views</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Database_transaction">Transactions</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Commit_(data_management)">Commits</a></li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h2 id="links-cont">Links, cont.</h2>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/Rollback_(data_management)#SQL">Rollback</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Distributed_data_store">Distributed data store</a></li>
  <li><a href="http://searchsqlserver.techtarget.com/definition/normalization">Normalization overview</a></li>
  <li><a href="http://guides.rubyonrails.org/active_record_basics.html">Rails ActiveRecord Basics</a></li>
  <li><a href="http://use-the-index-luke.com/">Use the Index, Luke</a></li>
  <li><a href="https://www.pythoncentral.io/sqlalchemy-vs-orms/">Python ORMs</a></li>
  <li><a href="https://www.khanacademy.org/computing/computer-programming/sql/sql-basics/v/welcome-to-sql">Khan Academy SQL Basics</a></li>
  <li><a href="https://thomaslarock.com/2015/06/101-things-i-wish-you-knew-about-sql-server/">101 things I wish I knew…</a></li>
</ul>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="drop-postgres-table">Drop Postgres table</h1>

<p><code>dropdb dbs_and_devs_talk</code></p>

<aside class="notes">

</aside>
</section>
<section>

<h1 id="thanks">Thanks!</h1>


<aside class="notes">

</aside>
</section>


			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'none', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
